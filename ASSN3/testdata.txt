# Check that the number of rows of Performance data for each Industry
# is correct.
select Industry, count(*)
  from Performance
  group by Industry
  order by Industry;

Industry	count(*)
Consumer Discretionary	850
Consumer Staples	1036
Energy	585
Financials	445
Health Care	550
Industrials	536
Information Technology	256
Materials	598
Telecommunications Services	370
Utilities	1450

# Check that the first Ticker in each Industry and the number of rows of
# Performance data for that Ticker is correct.
select Industry, min(Ticker) as Ticker, count(distinct Ticker) as NumTicker
  from Performance
  group by Industry
  order by Industry;

Industry	Ticker	NumTicker
Consumer Discretionary	AAP	85
Consumer Staples	ADM	37
Energy	APA	39
Financials	AFL	89
Health Care	A	55
Industrials	AAL	67
Information Technology	AAPL	64
Materials	AA	26
Telecommunications Services	CTL	5
Utilities	AEE	29

# Check that the first 50 rows of Performance data for Telecommunications
# Services is correct.
select Ticker, StartDate, EndDate, round(TickerReturn, 4) as TickerReturn, round(IndustryReturn, 4) as IndustryReturn
  from Performance
  where Industry = 'Telecommunications Services'
  order by StartDate, Ticker
  limit 50;

Ticker	StartDate	EndDate	TickerReturn	IndustryReturn
CTL	1998-03-31	1998-06-24	0.1721	-0.0802
FTR	1998-03-31	1998-06-24	-0.0417	-0.0268
LVLT	1998-03-31	1998-06-24	-0.1117	-0.0093
T	1998-03-31	1998-06-24	-0.0783	-0.0176
VZ	1998-03-31	1998-06-24	-0.0892	-0.0149
CTL	1998-06-25	1998-09-18	0.0416	-0.0585
FTR	1998-06-25	1998-09-18	-0.2593	0.0167
LVLT	1998-06-25	1998-09-18	0.0176	-0.0525
T	1998-06-25	1998-09-18	0.0359	-0.0571
VZ	1998-06-25	1998-09-18	-0.0282	-0.0410
CTL	1998-09-21	1998-12-14	0.2643	0.1302
FTR	1998-09-21	1998-12-14	0.0508	0.1836
LVLT	1998-09-21	1998-12-14	0.0887	0.1741
T	1998-09-21	1998-12-14	0.1756	0.1524
VZ	1998-09-21	1998-12-14	0.2056	0.1449
CTL	1998-12-15	1999-03-12	0.1253	0.2788
FTR	1998-12-15	1999-03-12	0.0484	0.2980
LVLT	1998-12-15	1999-03-12	0.9307	0.0774
T	1998-12-15	1999-03-12	0.0997	0.2852
VZ	1998-12-15	1999-03-12	0.0364	0.3010
CTL	1999-03-15	1999-06-08	-0.1378	0.1043
FTR	1999-03-15	1999-06-08	0.2403	0.0098
LVLT	1999-03-15	1999-06-08	0.0919	0.0468
T	1999-03-15	1999-06-08	0.0365	0.0607
VZ	1999-03-15	1999-06-08	0.0483	0.0577
CTL	1999-06-09	1999-09-01	0.0207	-0.0190
FTR	1999-06-09	1999-09-01	0.1188	-0.0435
LVLT	1999-06-09	1999-09-01	-0.1879	0.0332
T	1999-06-09	1999-09-01	-0.0965	0.0103
VZ	1999-06-09	1999-09-01	0.0897	-0.0362
CTL	1999-09-02	1999-11-26	0.1646	0.1102
FTR	1999-09-02	1999-11-26	0.1136	0.1229
LVLT	1999-09-02	1999-11-26	0.2569	0.0871
T	1999-09-02	1999-11-26	0.0479	0.1394
VZ	1999-09-02	1999-11-26	0.0224	0.1457
CTL	1999-11-29	2000-02-23	-0.2446	0.0505
FTR	1999-11-29	2000-02-23	0.2424	-0.0713
LVLT	1999-11-29	2000-02-23	0.4821	-0.1312
T	1999-11-29	2000-02-23	-0.3125	0.0674
VZ	1999-11-29	2000-02-23	-0.2102	0.0419
CTL	2000-02-24	2000-05-18	-0.1750	0.0072
FTR	2000-02-24	2000-05-18	0.0122	-0.0396
LVLT	2000-02-24	2000-05-18	-0.3083	0.0405
T	2000-02-24	2000-05-18	0.2487	-0.0987
VZ	2000-02-24	2000-05-18	0.0762	-0.0556
CTL	2000-05-19	2000-08-14	0.0482	-0.0859
FTR	2000-05-19	2000-08-14	0.0405	-0.0839
LVLT	2000-05-19	2000-08-14	-0.1644	-0.0327
T	2000-05-19	2000-08-14	-0.0233	-0.0680
VZ	2000-05-19	2000-08-14	-0.1962	-0.0248

# Check that the first 30 "best" returns are correct.
select Ticker, StartDate, EndDate, round(TickerReturn, 4) as TickerReturn, round(IndustryReturn, 4) as IndustryReturn
  from Performance
  order by TickerReturn - IndustryReturn DESC
  limit 30;

Ticker	StartDate	EndDate	TickerReturn	IndustryReturn
LVLT	2011-08-05	2011-10-28	11.3535	0.0195
DUK	2012-06-29	2012-09-24	1.7915	-0.0044
WFM	2009-02-11	2009-05-07	1.1302	0.0711
LVLT	2009-03-20	2009-06-15	1.0411	0.0469
LVLT	2005-08-22	2005-11-14	0.9271	-0.0614
GMCR	2013-11-15	2014-02-12	0.9662	-0.0172
LVLT	1998-12-15	1999-03-12	0.9307	0.0774
GMCR	2011-01-06	2011-04-01	0.8818	0.0639
GMCR	2009-02-11	2009-05-07	0.8359	0.0793
ILMN	2013-12-05	2014-03-04	0.8360	0.1091
STZ	2012-06-12	2012-09-05	0.7676	0.0417
LVLT	1999-11-29	2000-02-23	0.4821	-0.1312
NFLX	2015-03-31	2015-06-24	0.6128	0.0152
FTR	2002-10-11	2003-01-07	0.8412	0.2531
GMCR	2012-09-06	2012-12-03	0.5754	0.0207
TSO	2012-07-09	2012-10-01	0.6602	0.1331
LVLT	2006-02-13	2006-05-09	0.5562	0.0291
AES	2009-03-03	2009-05-27	0.5534	0.0482
LYB	2010-07-23	2010-10-15	0.6012	0.1278
MNST	2014-08-06	2014-10-29	0.5349	0.0733
LVLT	2011-02-14	2011-05-10	0.4320	-0.0035
ENDP	2013-09-11	2013-12-04	0.5075	0.0758
AAL	2013-11-18	2014-02-13	0.4463	0.0271
VZ	2008-09-26	2008-12-19	0.0560	-0.3547
AES	2009-05-28	2009-08-20	0.5495	0.1471
GMCR	2013-03-04	2013-05-28	0.4987	0.1040
GT	2013-06-19	2013-09-12	0.4494	0.0554
CAM	2015-08-14	2015-11-06	0.3645	-0.0265
COG	2012-04-12	2012-07-06	0.3254	-0.0630
CF	2010-07-23	2010-10-15	0.5166	0.1312

# Check that the first 30 "worst" returns are correct.
select Ticker, StartDate, EndDate, round(TickerReturn, 4) as TickerReturn, round(IndustryReturn, 4) as IndustryReturn
  from Performance
  order by TickerReturn - IndustryReturn ASC
  limit 20;

Ticker	StartDate	EndDate	TickerReturn	IndustryReturn
FTR	2011-08-05	2011-10-28	-0.0778	2.8774
T	2011-08-05	2011-10-28	0.0238	2.8520
CTL	2011-08-05	2011-10-28	0.0614	2.8426
VZ	2011-08-05	2011-10-28	0.0709	2.8402
VFC	2013-12-09	2014-03-06	-0.7432	0.0605
LVLT	2001-05-03	2001-07-27	-0.7391	0.0474
V	2015-01-02	2015-03-30	-0.7507	0.0273
NFLX	2015-06-25	2015-09-18	-0.8465	-0.0818
HBI	2015-02-19	2015-05-14	-0.7392	-0.0053
CF	2015-04-30	2015-07-24	-0.7916	-0.0949
LVLT	2008-09-26	2008-12-19	-0.7754	-0.1469
NI	2015-05-13	2015-08-06	-0.6220	0.0014
LVLT	2000-08-15	2000-11-07	-0.3998	0.2017
GMCR	2012-03-16	2012-06-11	-0.5795	0.0060
EBAY	2015-06-25	2015-09-18	-0.5781	-0.0861
DUK	2006-10-11	2007-01-08	-0.3886	0.0796
LVLT	2001-02-06	2001-05-02	-0.5171	-0.0749
CNX	2015-05-20	2015-08-13	-0.5813	-0.1529
LVLT	2002-10-11	2003-01-07	0.0313	0.4556
GMCR	2011-09-23	2011-12-16	-0.3436	0.0704

# Check that the sum of all the TickerReturns for an interval is equal to
# the sum of all the Industry returns for that same interval.
select Industry, StartDate, EndDate, round(sum(TickerReturn), 4) as TickerSum, round(sum(IndustryReturn), 4) as IndustrySum
  from Performance
  group by Industry, StartDate, EndDate
  having TickerSum != IndustrySum
  order by Industry, StartDate;

Industry	StartDate	EndDate	TickerSum	IndustrySum

# Check that all the returns for GMCR are correct.
select Ticker, StartDate, EndDate, round(TickerReturn, 4) as TickerReturn, round(IndustryReturn, 4) as IndustryReturn
  from Performance
  where Ticker = 'GMCR'
  order by StartDate;

Ticker	StartDate	EndDate	TickerReturn	IndustryReturn
GMCR	2009-02-11	2009-05-07	0.8359	0.0793
GMCR	2009-05-08	2009-08-03	0.3329	0.0862
GMCR	2009-08-04	2009-10-27	0.0644	0.0786
GMCR	2009-10-28	2010-01-25	0.1558	0.0335
GMCR	2010-01-26	2010-04-21	0.0460	0.1098
GMCR	2010-04-22	2010-07-16	-0.0224	-0.0302
GMCR	2010-07-19	2010-10-11	-0.0421	0.0528
GMCR	2010-10-12	2011-01-05	0.2902	0.0611
GMCR	2011-01-06	2011-04-01	0.8818	0.0639
GMCR	2011-04-04	2011-06-28	0.3712	0.0346
GMCR	2011-06-29	2011-09-22	0.1689	-0.0474
GMCR	2011-09-23	2011-12-16	-0.3436	0.0704
GMCR	2011-12-19	2012-03-15	0.1223	0.0613
GMCR	2012-03-16	2012-06-11	-0.5795	0.0060
GMCR	2012-06-12	2012-09-05	0.1079	0.0600
GMCR	2012-09-06	2012-12-03	0.5754	0.0207
GMCR	2012-12-04	2013-03-01	0.2754	0.0849
GMCR	2013-03-04	2013-05-28	0.4987	0.1040
GMCR	2013-05-29	2013-08-21	0.1532	-0.0185
GMCR	2013-08-22	2013-11-14	-0.2729	0.0801
GMCR	2013-11-15	2014-02-12	0.9662	-0.0172
GMCR	2014-02-13	2014-05-09	-0.0872	0.0806
GMCR	2014-05-12	2014-08-05	0.0824	-0.0227
GMCR	2014-08-06	2014-10-29	0.2509	0.0812
GMCR	2014-10-30	2015-01-27	-0.1254	0.0896
GMCR	2015-01-28	2015-04-23	-0.1160	0.0077
GMCR	2015-04-24	2015-07-20	-0.3795	0.0197
GMCR	2015-07-21	2015-10-13	0.1729	0.0166

# Check that all the returns for LVLT are correct.
select Ticker, StartDate, EndDate, round(TickerReturn, 4) as TickerReturn, round(IndustryReturn, 4) as IndustryReturn
  from Performance
  where Ticker = 'LVLT'
  order by StartDate;

Ticker	StartDate	EndDate	TickerReturn	IndustryReturn
LVLT	1998-03-31	1998-06-24	-0.1117	-0.0093
LVLT	1998-06-25	1998-09-18	0.0176	-0.0525
LVLT	1998-09-21	1998-12-14	0.0887	0.1741
LVLT	1998-12-15	1999-03-12	0.9307	0.0774
LVLT	1999-03-15	1999-06-08	0.0919	0.0468
LVLT	1999-06-09	1999-09-01	-0.1879	0.0332
LVLT	1999-09-02	1999-11-26	0.2569	0.0871
LVLT	1999-11-29	2000-02-23	0.4821	-0.1312
LVLT	2000-02-24	2000-05-18	-0.3083	0.0405
LVLT	2000-05-19	2000-08-14	-0.1644	-0.0327
LVLT	2000-08-15	2000-11-07	-0.3998	0.2017
LVLT	2000-11-08	2001-02-05	-0.0337	-0.0874
LVLT	2001-02-06	2001-05-02	-0.5171	-0.0749
LVLT	2001-05-03	2001-07-27	-0.7391	0.0474
LVLT	2001-07-30	2001-10-26	-0.1505	-0.1276
LVLT	2001-10-29	2002-01-24	0.2459	0.0137
LVLT	2002-01-25	2002-04-22	-0.0365	-0.0523
LVLT	2002-04-23	2002-07-17	0.2248	-0.1443
LVLT	2002-07-18	2002-10-10	-0.2296	-0.1736
LVLT	2002-10-11	2003-01-07	0.0313	0.4556
LVLT	2003-01-08	2003-04-03	0.1059	-0.1415
LVLT	2003-04-04	2003-06-30	0.2065	0.1751
LVLT	2003-07-01	2003-09-24	-0.1955	-0.1106
LVLT	2003-09-25	2003-12-18	-0.0220	0.0551
LVLT	2003-12-19	2004-03-17	-0.2615	0.0052
LVLT	2004-03-18	2004-06-14	-0.0930	-0.0027
LVLT	2004-06-15	2004-09-08	-0.2115	0.0764
LVLT	2004-09-09	2004-12-02	0.2552	0.0462
LVLT	2004-12-03	2005-03-01	-0.3619	-0.0705
LVLT	2005-03-02	2005-05-25	-0.1681	-0.0305
LVLT	2005-05-26	2005-08-19	-0.0103	0.0214
LVLT	2005-08-22	2005-11-14	0.9271	-0.0614
LVLT	2005-11-15	2006-02-10	-0.0464	0.0700
LVLT	2006-02-13	2006-05-09	0.5562	0.0291
LVLT	2006-05-10	2006-08-03	-0.3321	0.0587
LVLT	2006-08-04	2006-10-27	0.4130	0.1035
LVLT	2006-10-30	2007-01-26	0.2154	0.0223
LVLT	2007-01-29	2007-04-24	-0.0366	0.0523
LVLT	2007-04-25	2007-07-19	-0.0247	0.0390
LVLT	2007-07-20	2007-10-12	-0.1751	-0.0014
LVLT	2007-10-15	2008-01-09	-0.3819	-0.1296
LVLT	2008-01-10	2008-04-07	-0.2353	-0.0552
LVLT	2008-04-08	2008-07-01	0.3273	-0.0046
LVLT	2008-07-02	2008-09-25	0.0034	-0.0271
LVLT	2008-09-26	2008-12-19	-0.7754	-0.1469
LVLT	2008-12-22	2009-03-19	0.0588	-0.1007
LVLT	2009-03-20	2009-06-15	1.0411	0.0469
LVLT	2009-06-16	2009-09-09	-0.2403	0.0162
LVLT	2009-09-10	2009-12-03	0.1624	0.1222
LVLT	2009-12-04	2010-03-03	0.1594	-0.0944
LVLT	2010-03-04	2010-05-27	-0.1698	-0.0098
LVLT	2010-05-28	2010-08-23	-0.1769	0.0385
LVLT	2010-08-24	2010-11-16	0.0571	0.1259
LVLT	2010-11-17	2011-02-11	0.1062	0.0714
LVLT	2011-02-14	2011-05-10	0.4320	-0.0035
LVLT	2011-05-11	2011-08-04	0.1868	-0.1486
LVLT	2011-08-05	2011-10-28	11.3535	0.0195
LVLT	2011-10-31	2012-01-26	-0.2502	-0.0617
LVLT	2012-01-27	2012-04-23	0.1657	0.0088
LVLT	2012-04-24	2012-07-18	-0.0766	0.0862
LVLT	2012-07-19	2012-10-11	0.0322	0.0570
LVLT	2012-10-12	2013-01-10	0.0763	-0.0431
LVLT	2013-01-11	2013-04-09	-0.1059	0.0242
LVLT	2013-04-10	2013-07-03	-0.0272	-0.0269
LVLT	2013-07-05	2013-09-27	0.2587	-0.0410
LVLT	2013-09-30	2013-12-23	0.2507	0.0409
LVLT	2013-12-24	2014-03-21	0.1890	0.0246
LVLT	2014-03-24	2014-06-17	0.1111	0.0701
LVLT	2014-06-18	2014-09-11	0.0442	0.0590
LVLT	2014-09-12	2014-12-05	0.0755	0.0028
LVLT	2014-12-08	2015-03-05	0.1449	0.0142
LVLT	2015-03-06	2015-06-01	0.0087	-0.0971
LVLT	2015-06-02	2015-08-25	-0.2196	-0.1135
LVLT	2015-08-26	2015-11-18	0.1451	0.0352

# Check that the the number of intervals for all Tickers in a given
# Industry are the same.
select Industry, min(IntervalCount) as MinInterval, max(IntervalCount) as MaxInterval
  from (select Industry, Ticker, count(*) as IntervalCount
          from Performance
          group by Industry, Ticker) as TickerCount
  group by Industry
  having MinInterval != MaxInterval;

Industry	MinInterval	MaxInterval

# Check that all the cases where the TickerReturn is not simply the
# close/open ratio for the start and end dates of the interval is correct.
# In general, this corresponds to cases where there was a stock split in
# the interval.
select Industry, Performance.Ticker, StartDate, EndDate, TickerReturn as PerformanceReturn, ClosePV.ClosePrice / OpenPV.OpenPrice - 1 as PVReturn
  from (Performance
         join reedy330.PriceVolume as OpenPV on Performance.Ticker = OpenPV.Ticker and Performance.StartDate = OpenPV.TransDate)
         join reedy330.PriceVolume as ClosePV on Performance.Ticker = ClosePV.Ticker and Performance.EndDate = ClosePV.TransDate
  where Industry = 'Consumer Staples' and round(TickerReturn, 2) != round(ClosePV.ClosePrice / OpenPV.OpenPrice - 1, 2)
  order by Industry, Performance.Ticker, StartDate;

Industry	Ticker	StartDate	EndDate	PerformanceReturn	PVReturn
Consumer Staples	BF-B	2012-06-12	2012-09-05	0.1067531	-0.26216462
Consumer Staples	CCE	2010-07-19	2010-10-11	0.2263879	-0.18240807
Consumer Staples	CHD	2011-04-04	2011-06-28	0.0065000	-0.49675000
Consumer Staples	CL	2013-03-04	2013-05-28	0.0804698	-0.45976508
Consumer Staples	EL	2011-12-19	2012-03-15	0.1596377	-0.42018114
Consumer Staples	GIS	2010-04-22	2010-07-16	0.0118149	-0.49409253
Consumer Staples	GMCR	2009-05-08	2009-08-03	0.3328724	-0.11141841
Consumer Staples	GMCR	2010-04-22	2010-07-16	-0.0223653	-0.67412178
Consumer Staples	GMCR	2011-09-23	2011-12-16	-0.3435506	-0.56236705
Consumer Staples	GMCR	2015-07-21	2015-10-13	0.1729018	-0.21806543
Consumer Staples	HRL	2011-01-06	2011-04-01	0.1323706	-0.43381468
Consumer Staples	KO	2012-06-12	2012-09-05	0.0005335	-0.49973326
Consumer Staples	KR	2015-04-24	2015-07-20	0.0973526	-0.45132371
Consumer Staples	MDLZ	2012-09-06	2012-12-03	-0.0783868	-0.38559119
Consumer Staples	MNST	2011-12-19	2012-03-15	0.2408562	-0.37957190
Consumer Staples	RAI	2010-10-12	2011-01-05	0.1244224	-0.43778881
Consumer Staples	RAI	2015-07-21	2015-10-13	0.1691767	-0.41541165
Consumer Staples	WFM	2013-05-29	2013-08-21	-0.0096756	-0.50483779